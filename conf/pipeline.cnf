[global]
version=vdp3.0

pbs_shebang=#!/bin/bash
#pbs_project=xx92
pbs_project=u86
pbs_queue=normal
pbs_storage=gdata/u86+gdata/xx92
pbs_other=gdata
pbs_umask=0007
pbs_group_list=xx92

read_regex1=.*_R?1_.*\.f(ast)?q\.gz
read_regex2=_R?1_
env_file=environment.txt

[directories]
pipeline=/g/data/xx92/$version
#reads=/g/data/xx92/ma8803/reads
work=/g/data/xx92/data/$version
tools=/g/data/xx92/vdp3.0/software
genome=/g/data/xx92/vdp3.0/GRCh38
vep_index=$[directories]genome/vep_index
vep_db=$[directories]genome/vep_db
reads=reads
qsub=qsub
run=run
result=result
tmp=tmp

[references]
gatkbundle=GATK_bundle_v0
genome_fasta=$[directories]genome/$[references]gatkbundle/Homo_sapiens_assembly38.fasta
wgs_calling_regions=$[directories]genome/$[references]gatkbundle/wgs_calling_regions.hg38.interval_list
bqsr_known_sites=$[directories]genome/$[references]gatkbundle/Homo_sapiens_assembly38.dbsnp138.vcf;$[directories]genome/$[references]gatkbundle/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz;$[directories]genome/$[references]gatkbundle/Homo_sapiens_assembly38.known_indels.vcf.gz
vqsr_known_sites_snp=$[directories]genome/$[references]gatkbundle/Homo_sapiens_assembly38.dbsnp138.vcf;$[directories]genome/$[references]gatkbundle/hapmap_3.3.hg38.vcf.gz;$[directories]genome/$[references]gatkbundle/1000G_omni2.5.hg38.vcf.gz;$[directories]genome/$[references]gatkbundle/1000G_phase1.snps.high_confidence.hg38.vcf.gz
vqsr_known_sites_indel=$[directories]genome/$[references]gatkbundle/Homo_sapiens_assembly38.dbsnp138.vcf;$[directories]genome/$[references]gatkbundle/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz;$[directories]genome/$[references]gatkbundle/Axiom_Exome_Plus.genotypes.all_populations.poly.hg38.vcf.gz

[targets]
#calling regions in BED format:
SureSelect_Clinical_Research_Exome_V2=$[directories]genome/targets/S30409818_Padded.bed
WES=$[targets]SureSelect_Clinical_Research_Exome_V2
WGS=$[directories]genome/targets/wgs.bed

#regions in interval format to calculate picard Hybrid-selection 'CollectHsMetrics' statistics:
hs_bait=$[directories]genome/targets/S30409818_Covered.interval_list
hs_target=$[directories]genome/targets/S30409818_Regions_named.interval_list

#GATK cnv targets - they are WES hs_target plus 250bp on each side; 
# they are then split into 10 consequitive files for scattering with IntervalListTools; we can't use our 'normal' chromosomal splits, 
#as the cnv splits MUST BE consequitive (intervals must be ordered within and between the files) or PostprocessGermlineCNVCalls fails
cnv_target = $[directories]genome/GATK_cnv/cnv_WES.interval_list

[tools]
fastqc=$[directories]tools/FastQC/fastqc
bwa=$[directories]tools/bwa-0.7.17/bwa
picard=java -Djava.io.tmpdir=\$PBS_JOBFS -DGATK_STACKTRACE_ON_USER_EXCEPTION=true -Xms4000m -jar $[directories]tools/picard.jar
samtools=$[directories]tools/samtools-1.10/samtools
bedtools=$[directories]tools/bedtools2/bin/bedtools
bcftools=$[directories]tools/bcftools-1.10.2/bcftools
bgzip=$[directories]tools/htslib-1.10.2/bgzip
tabix=$[directories]tools/htslib-1.10.2/tabix
gatk=$[directories]tools/gatk-4.1.5.0/gatk
varscan=java -Djava.io.tmpdir=\$PBS_JOBFS -DGATK_STACKTRACE_ON_USER_EXCEPTION=true -Xms4000m -jar $[directories]tools/VarScan.v2.4.4.jar
strelka=$[directories]tools/strelka-2.9.10/bin
vep=$[directories]tools/ensembl-vep-release-99.2/vep
peddy=export PYTHONPATH="\$PYTHONPATH:$[directories]tools/peddy"; python3.7 -m peddy

[tool_versions]
FastQC=$[tools]fastqc -v | cut -d ' ' -f 2
BWA=$[tools]bwa 2>&1 | grep Version: | awk '{print \$2}'
Picard=$[tools]picard MarkDuplicates --version 2>&1
SamTools=$[tools]samtools 2>&1 | grep Version: | awk '{print \$2}'
BedTools=$[tools]bedtools | grep Version: | awk '{print \$2}'
BCFTools=$[tools]bcftools 2>&1 | grep Version: | awk '{print \$2}'
GATK=$[tools]gatk --version 2>/dev/null | grep 'The Genome Analysis Toolkit' | awk '{print \$NF}'
VarScan=$[tools]varscan 2>&1 | grep VarScan | head -n 1 | awk '{print \$2}'
Strelka=echo '2.9.10'
Ensembl_VEP=echo '99.2'
peddy=$[tools]peddy --version 2>/dev/null | awk '{print \$NF}'

[db_versions]
Genome_Reference=Homo Sampiens GRCh38
GATK_bundle=hg38/v0
Ensembl_VEP=99_GRCh38
GnomAD=3.0
CADD=v1.5
ClinVar=2020.03.10
Cosmic=v90

[split]
01=split:1_21
02=split:2_18
03=split:3_14
04=split:4_15_M
05=split:5_13_Y
06=split:6_9
07=split:7_10
08=split:8_11
09=split:12_22_X_Un
10=split:16_17_19_20

[split:1_21]
bed=$[directories]genome/splits/1_21.bed
gvcfdb=$[directories]genome/gvcfs/CCG_WES.01.gdb
cnv=$[directories]genome/GATK_cnv/cnv_WES.01.interval_list
intervals=chr1,chr21

[split:2_18]
bed=$[directories]genome/splits/2_18.bed
gvcfdb=$[directories]genome/gvcfs/CCG_WES.02.gdb
cnv=$[directories]genome/GATK_cnv/cnv_WES.02.interval_list
intervals=chr2,chr18

[split:3_14]
bed=$[directories]genome/splits/3_14.bed
gvcfdb=$[directories]genome/gvcfs/CCG_WES.03.gdb
cnv=$[directories]genome/GATK_cnv/cnv_WES.03.interval_list
intervals=chr3,chr14

[split:4_15_M]
bed=$[directories]genome/splits/4_15_M.bed
gvcfdb=$[directories]genome/gvcfs/CCG_WES.04.gdb
cnv=$[directories]genome/GATK_cnv/cnv_WES.04.interval_list
intervals=chr4,chr15,chrM,

[split:5_13_Y]
bed=$[directories]genome/splits/5_13_Y.bed
gvcfdb=$[directories]genome/gvcfs/CCG_WES.05.gdb
cnv=$[directories]genome/GATK_cnv/cnv_WES.05.interval_list
intervals=chr5,chr13,chrY

[split:6_9]
bed=$[directories]genome/splits/6_9.bed
gvcfdb=$[directories]genome/gvcfs/CCG_WES.06.gdb
cnv=$[directories]genome/GATK_cnv/cnv_WES.06.interval_list
intervals=chr6,chr9

[split:7_10]
bed=$[directories]genome/splits/7_10.bed
gvcfdb=$[directories]genome/gvcfs/CCG_WES.07.gdb
cnv=$[directories]genome/GATK_cnv/cnv_WES.07.interval_list
intervals=chr7,chr10

[split:8_11]
bed=$[directories]genome/splits/8_11.bed
gvcfdb=$[directories]genome/gvcfs/CCG_WES.08.gdb
cnv=$[directories]genome/GATK_cnv/cnv_WES.08.interval_list
intervals=chr8,chr11

[split:12_22_X_Un]
bed=$[directories]genome/splits/12_22_X_Un.bed
gvcfdb=$[directories]genome/gvcfs/CCG_WES.09.gdb
cnv=$[directories]genome/GATK_cnv/cnv_WES.09.interval_list
intervals=chr12,chr22,chrX,chr1_KI270706v1_random,chr1_KI270707v1_random,chr1_KI270708v1_random,chr1_KI270709v1_random,chr1_KI270710v1_random,chr1_KI270711v1_random,chr1_KI270712v1_random,chr1_KI270713v1_random,chr1_KI270714v1_random,chr2_KI270715v1_random,chr2_KI270716v1_random,chr3_GL000221v1_random,chr4_GL000008v2_random,chr5_GL000208v1_random,chr9_KI270717v1_random,chr9_KI270718v1_random,chr9_KI270719v1_random,chr9_KI270720v1_random,chr11_KI270721v1_random,chr14_GL000009v2_random,chr14_GL000225v1_random,chr14_KI270722v1_random,chr14_GL000194v1_random,chr14_KI270723v1_random,chr14_KI270724v1_random,chr14_KI270725v1_random,chr14_KI270726v1_random,chr15_KI270727v1_random,chr16_KI270728v1_random,chr17_GL000205v2_random,chr17_KI270729v1_random,chr17_KI270730v1_random,chr22_KI270731v1_random,chr22_KI270732v1_random,chr22_KI270733v1_random,chr22_KI270734v1_random,chr22_KI270735v1_random,chr22_KI270736v1_random,chr22_KI270737v1_random,chr22_KI270738v1_random,chr22_KI270739v1_random,chrY_KI270740v1_random,chrUn_KI270302v1,chrUn_KI270304v1,chrUn_KI270303v1,chrUn_KI270305v1,chrUn_KI270322v1,chrUn_KI270320v1,chrUn_KI270310v1,chrUn_KI270316v1,chrUn_KI270315v1,chrUn_KI270312v1,chrUn_KI270311v1,chrUn_KI270317v1,chrUn_KI270412v1,chrUn_KI270411v1,chrUn_KI270414v1,chrUn_KI270419v1,chrUn_KI270418v1,chrUn_KI270420v1,chrUn_KI270424v1,chrUn_KI270417v1,chrUn_KI270422v1,chrUn_KI270423v1,chrUn_KI270425v1,chrUn_KI270429v1,chrUn_KI270442v1,chrUn_KI270466v1,chrUn_KI270465v1,chrUn_KI270467v1,chrUn_KI270435v1,chrUn_KI270438v1,chrUn_KI270468v1,chrUn_KI270510v1,chrUn_KI270509v1,chrUn_KI270518v1,chrUn_KI270508v1,chrUn_KI270516v1,chrUn_KI270512v1,chrUn_KI270519v1,chrUn_KI270522v1,chrUn_KI270511v1,chrUn_KI270515v1,chrUn_KI270507v1,chrUn_KI270517v1,chrUn_KI270529v1,chrUn_KI270528v1,chrUn_KI270530v1,chrUn_KI270539v1,chrUn_KI270538v1,chrUn_KI270544v1,chrUn_KI270548v1,chrUn_KI270583v1,chrUn_KI270587v1,chrUn_KI270580v1,chrUn_KI270581v1,chrUn_KI270579v1,chrUn_KI270589v1,chrUn_KI270590v1,chrUn_KI270584v1,chrUn_KI270582v1,chrUn_KI270588v1,chrUn_KI270593v1,chrUn_KI270591v1,chrUn_KI270330v1,chrUn_KI270329v1,chrUn_KI270334v1,chrUn_KI270333v1,chrUn_KI270335v1,chrUn_KI270338v1,chrUn_KI270340v1,chrUn_KI270336v1,chrUn_KI270337v1,chrUn_KI270363v1,chrUn_KI270364v1,chrUn_KI270362v1,chrUn_KI270366v1,chrUn_KI270378v1,chrUn_KI270379v1,chrUn_KI270389v1,chrUn_KI270390v1,chrUn_KI270387v1,chrUn_KI270395v1,chrUn_KI270396v1,chrUn_KI270388v1,chrUn_KI270394v1,chrUn_KI270386v1,chrUn_KI270391v1,chrUn_KI270383v1,chrUn_KI270393v1,chrUn_KI270384v1,chrUn_KI270392v1,chrUn_KI270381v1,chrUn_KI270385v1,chrUn_KI270382v1,chrUn_KI270376v1,chrUn_KI270374v1,chrUn_KI270372v1,chrUn_KI270373v1,chrUn_KI270375v1,chrUn_KI270371v1,chrUn_KI270448v1,chrUn_KI270521v1,chrUn_GL000195v1,chrUn_GL000219v1,chrUn_GL000220v1,chrUn_GL000224v1,chrUn_KI270741v1,chrUn_GL000226v1,chrUn_GL000213v1,chrUn_KI270743v1,chrUn_KI270744v1,chrUn_KI270745v1,chrUn_KI270746v1,chrUn_KI270747v1,chrUn_KI270748v1,chrUn_KI270749v1,chrUn_KI270750v1,chrUn_KI270751v1,chrUn_KI270752v1,chrUn_KI270753v1,chrUn_KI270754v1,chrUn_KI270755v1,chrUn_KI270756v1,chrUn_KI270757v1,chrUn_GL000214v1,chrUn_KI270742v1,chrUn_GL000216v2,chrUn_GL000218v1

[split:16_17_19_20]
bed=$[directories]genome/splits/16_17_19_20.bed
gvcfdb=$[directories]genome/gvcfs/CCG_WES.10.gdb
cnv=$[directories]genome/GATK_cnv/cnv_WES.10.interval_list
intervals=chr16,chr17,chr19,chr20

[steps]
1:readfile=fastqc
2:readfile=bwa
4:individual=merge_bam
5:cohort=merge_target
6:individual=mark_duplicates
7:individual=split:bqsr_recal
8:individual=bqsr_gather_rep
9:individual=split:bqsr_apply
10:individual=bqsr_gather_bam
11:individual=split:filter_bam
12:cohort=split:mpileup
13:individual=split:gatk_hc
14:cohort=split:gatk_combine_gvcfs
15:cohort=split:gatk_genotype_gvcfs
16:cohort=gatk_vqsr_recal_indel
17:cohort=gatk_vqsr_recal_snp
18:cohort=split:gatk_vqsr_apply_indel
19:cohort=split:gatk_vqsr_apply_snp
20:cohort=split:varscan_indel
21:cohort=split:varscan_snp
22:cohort=split:strelka
23:cohort=split:merge_callers
24:cohort=split:vep
25:cohort=report_snv
#26:cohort=gatk_cnv_intervals
27:individual=gatk_cnv_read_counts
28:individual=gatk_cnv_ploidy
29:individual=split:gatk_cnv_caller
30:individual=gatk_cnv_gather_calls
31:cohort=report_cnv
99:cohort=summary_report

[step:fastqc]
dir=fastqc
pbs_queue=$[global]pbs_queue
pbs_mem=2GB
pbs_ncpus=2
pbs_walltime=02:00:00
pbs_jobfs=10GB
modules=java/jdk-13.33
cmd_1=$[directories]pipeline/scripts/step_fastqc.pl
fastqc_bin=$[tools]fastqc

[step:bwa]
dir=bwa
pbs_queue=$[global]pbs_queue
pbs_mem=32GB
pbs_ncpus=32
pbs_walltime=08:00:00
pbs_jobfs=200GB
modules=java/jdk-13.33
cmd_1=$[directories]pipeline/scripts/step_bwa.pl
bwa_bin=$[tools]bwa
picard_bin=$[tools]picard

[step:merge_bam]
dir=bam
pbs_queue=$[global]pbs_queue
pbs_mem=8GB
pbs_ncpus=1
pbs_walltime=08:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33
cmd_1=$[directories]pipeline/scripts/step_mergebam.pl
picard_bin=$[tools]picard

[step:merge_target]
dir=bam
pbs_queue=$[global]pbs_queue
pbs_mem=1GB
pbs_ncpus=1
pbs_walltime=00:30:00
pbs_jobfs=100GB
cmd_1=$[directories]pipeline/scripts/step_mergetarget.pl
bedintersect_bin=$[tools]bedtools
bgzip_bin=$[tools]bgzip
tabix_bin=$[tools]tabix

[step:mark_duplicates]
dir=bam
pbs_queue=$[global]pbs_queue
pbs_mem=16GB
pbs_ncpus=1
pbs_walltime=08:00:00
pbs_jobfs=200GB
modules=java/jdk-13.33
cmd_1=$[directories]pipeline/scripts/step_markduplicates.pl
picard_bin=$[tools]picard

[step:split:bqsr_recal]
dir=bqsr
pbs_queue=$[global]pbs_queue
pbs_mem=8GB
pbs_ncpus=4
pbs_walltime=08:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_bqsrrecal.pl
gatk_bin=$[tools]gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xms4000m  -XX:+UseParallelGC -XX:ParallelGCThreads=4 -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"

[step:bqsr_gather_rep]
dir=bqsr
pbs_queue=$[global]pbs_queue
pbs_mem=8GB
pbs_ncpus=1
pbs_walltime=08:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_bqsrgatherrep.pl
gatk_bin=$[tools]gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xms4000m  -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"

[step:split:bqsr_apply]
dir=bqsr
pbs_queue=$[global]pbs_queue
pbs_mem=16GB
pbs_ncpus=4
pbs_walltime=08:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_bqsrapply.pl
gatk_bin=$[tools]gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xms4000m  -XX:+UseParallelGC -XX:ParallelGCThreads=4 -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"

[step:bqsr_gather_bam]
dir=bam
pbs_queue=$[global]pbs_queue
pbs_mem=16GB
pbs_ncpus=8
pbs_walltime=08:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_bqsrgatherbam.pl
picard_bin=$[tools]picard

[step:split:filter_bam]
dir=bam
pbs_queue=$[global]pbs_queue
pbs_mem=4GB
pbs_ncpus=1
pbs_walltime=08:00:00
pbs_jobfs=100GB
cmd_1=$[directories]pipeline/scripts/step_filterbam.pl
samtools_bin=$[tools]samtools
incl_flags=PROPER_PAIR
excl_flags=UNMAP,MUNMAP,SECONDARY,QCFAIL,DUP,SUPPLEMENTARY
min_MQ=10

[step:split:mpileup]
dir=bam
pbs_queue=$[global]pbs_queue
pbs_mem=4GB
pbs_ncpus=1
pbs_walltime=08:00:00
pbs_jobfs=100GB
cmd_1=$[directories]pipeline/scripts/step_mpileup.pl
mpileup_bin=$[tools]samtools
min_BQ=13

[step:split:gatk_hc]
dir=gatk_hc
pbs_queue=$[global]pbs_queue
pbs_mem=8GB
pbs_ncpus=8
pbs_walltime=03:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_gatkhaplotypecaller.pl
#there is an error in gatk-4.1.5 rendering HaplotypeCaller useless, we use gatk-4.1.4 instead
#gatk_bin=$[tools]gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xms6000m -XX:GCTimeLimit=50 -XX:GCHeapFreeLimit=10 -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"
gatk_bin=$[directories]tools/gatk-4.1.4.1/gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xms6000m -XX:GCTimeLimit=50 -XX:GCHeapFreeLimit=10 -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"
read_filter_add=MateDifferentStrandReadFilter

[step:split:gatk_combine_gvcfs]
dir=gatk_hc
pbs_queue=$[global]pbs_queue
pbs_mem=8GB
pbs_ncpus=1
pbs_walltime=03:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_gatkcombinegvcfs.pl
#there is an error in gatk-4.1.5 rendering GenomicsDBImport useless, we use gatk-4.1.4 instead
#gatk_bin=$[tools]gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xmx4g -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"
gatk_bin=$[directories]tools/gatk-4.1.5.0/gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xmx4g -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"

[step:split:gatk_genotype_gvcfs]
dir=gatk_hc
pbs_queue=$[global]pbs_queue
pbs_mem=16GB
pbs_ncpus=8
pbs_walltime=08:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_gatkgenotypegvcfs.pl
gatk_bin=$[tools]gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xmx4g -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"

[step:gatk_vqsr_recal_indel]
dir=gatk_hc
pbs_queue=$[global]pbs_queue
pbs_mem=16GB
pbs_ncpus=2
pbs_walltime=08:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python,R/3.6.1
cmd_1=$[directories]pipeline/scripts/step_gatkvqsr.pl --fun recal --mode INDEL
gatk_bin=export R_LIBS_USER=$[directories]tools/R/3.6/lib; $[tools]gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xms8g -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"
plots_bin=$[directories]pipeline/scripts/plot_Trenches.R
#as per GATK advise we don't make tranches plot for indels
makeplots=false

#INDEL VQSR parameters:
tranche=100.0,99.9,99.0,90.0
#DP should NOT by used for exomes, only for WGS
annotation=FS,ReadPosRankSum,MQRankSum,QD,SOR
#annotation=FS,ReadPosRankSum,QD,SOR,DP
#annotation=QD,DP
resources=dbsnp,known=true,training=false,truth=false,prior=2 $[directories]genome/$[references]gatkbundle/Homo_sapiens_assembly38.dbsnp138.vcf;mills,known=false,training=true,truth=true,prior=12 $[directories]genome/$[references]gatkbundle/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz;axiomPoly,known=false,training=true,truth=false,prior=10 $[directories]genome/$[references]gatkbundle/Axiom_Exome_Plus.genotypes.all_populations.poly.hg38.vcf.gz
gauss=4,2,1

[step:gatk_vqsr_recal_snp]
dir=gatk_hc
pbs_queue=$[global]pbs_queue
pbs_mem=16GB
pbs_ncpus=2
pbs_walltime=08:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python,R/3.6.1
cmd_1=$[directories]pipeline/scripts/step_gatkvqsr.pl --fun recal --mode SNP
gatk_bin=export R_LIBS_USER=$[directories]tools/R/3.6/lib; $[tools]gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xms8g -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"
plots_bin=Rscript $[directories]pipeline/scripts/plot_Trenches.R
makeplots=true

#SNP VQSR parameters:
tranche=100.0,99.9,99.0,90.0
#DP should NOT by used for exomes, only for WGS
annotation=QD,MQRankSum,ReadPosRankSum,FS,MQ,SOR
#annotation=QD,MQRankSum,ReadPosRankSum,FS,SOR,DP
resources=dbsnp,known=true,training=false,truth=false,prior=7 $[directories]genome/$[references]gatkbundle/Homo_sapiens_assembly38.dbsnp138.vcf;hapmap,known=false,training=true,truth=true,prior=15 $[directories]genome/$[references]gatkbundle/hapmap_3.3.hg38.vcf.gz;omni,known=false,training=true,truth=true,prior=12 $[directories]genome/$[references]gatkbundle/1000G_omni2.5.hg38.vcf.gz;1000G,known=false,training=true,truth=false,prior=10 $[directories]genome/$[references]gatkbundle/1000G_phase1.snps.high_confidence.hg38.vcf.gz
gauss=6,4,2,1

[step:split:gatk_vqsr_apply_indel]
dir=gatk_hc
pbs_queue=$[global]pbs_queue
pbs_mem=8GB
pbs_ncpus=1
pbs_walltime=04:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_gatkvqsr.pl --fun apply --mode INDEL
gatk_bin=$[tools]gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xms8g -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"
bcftools_bin=$[tools]bcftools
tabix_bin=$[tools]tabix
#this is the sensitiviti cutoff for tranche (tranche of this value must be defined in vqsr_recal_indell step
sensitivity_cutoff=100

[step:split:gatk_vqsr_apply_snp]
dir=gatk_hc
pbs_queue=$[global]pbs_queue
pbs_mem=8GB
pbs_ncpus=1
pbs_walltime=04:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_gatkvqsr.pl --fun apply --mode SNP
gatk_bin=$[tools]gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xms8g -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"
bcftools_bin=$[tools]bcftools
tabix_bin=$[tools]tabix
#this is the sensitiviti cutoff for tranche (tranche of this value must be defined in vqsr_recal_snp step
sensitivity_cutoff=100

[step:split:varscan_indel]
dir=varscan
pbs_queue=$[global]pbs_queue
pbs_mem=16GB
pbs_ncpus=8
pbs_walltime=08:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_varscan.pl --fun call --mode INDEL
varscan_bin=$[tools]varscan
bgzip_bin=$[tools]bgzip
tabix_bin=$[tools]tabix

min_coverage=8
min_reads2=2
min_avg_qual=15
min_var_freq=0.01
p_value=0.1

[step:split:varscan_snp]
dir=varscan
pbs_queue=$[global]pbs_queue
pbs_mem=16GB
pbs_ncpus=8
pbs_walltime=08:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_varscan.pl --fun call --mode SNP
varscan_bin=$[tools]varscan
bgzip_bin=$[tools]bgzip
tabix_bin=$[tools]tabix
bcftools_bin=$[tools]bcftools

min_coverage=8
min_reads2=5
min_avg_qual=15
min_var_freq=0.2
p_value=0.1

[step:split:strelka]
dir=strelka
pbs_queue=$[global]pbs_queue
pbs_mem=16GB
pbs_ncpus=8
pbs_walltime=08:00:00
pbs_jobfs=100GB
modules=python2-as-python
cmd_1=$[directories]pipeline/scripts/step_strelka.pl
run_bin=$[tools]strelka/configureStrelkaGermlineWorkflow.py
config_bin=$[tools]strelka/configureStrelkaGermlineWorkflow.py
bedtools_bin=$[tools]bedtools
bcftools_bin=$[tools]bcftools
bgzip_bin=$[tools]bgzip
tabix_bin=$[tools]tabix

[step:split:merge_callers]
dir=vcf
pbs_queue=$[global]pbs_queue
pbs_mem=4GB
pbs_ncpus=1
pbs_walltime=08:00:00
pbs_jobfs=100GB
cmd_1=$[directories]pipeline/scripts/step_mergecallers.pl
bcftools_bin=$[tools]bcftools
bgzip_bin=$[tools]bgzip
tabix_bin=$[tools]tabix

[step:split:vep]
dir=vcf
pbs_queue=$[global]pbs_queue
pbs_mem=8GB
pbs_ncpus=2
pbs_walltime=08:00:00
pbs_jobfs=100GB
cmd_1=$[directories]pipeline/scripts/step_vep.pl
vep_bin=$[tools]vep
bcftools_bin=$[tools]bcftools
bgzip_bin=$[tools]bgzip
tabix_bin=$[tools]tabix
gnomad_vcf=$[directories]vep_db/gnomad.genomes.r3.0.sites.vcf.bgz
clinvar_vcf=$[directories]vep_db/clinvar_20200310.vcf.gz
cosmic_coding_vcf=$[directories]vep_db/CosmicCodingMuts.vcf.gz
cosmic_noncoding_vcf=$[directories]vep_db/CosmicNonCodingVariants.vcf.gz
cad=$[directories]vep_db/whole_genome_SNVs.tsv.gz
fasta=$[directories]vep_db/Homo_sapiens.GRCh38.dna.primary_assembly.fa.bgz

[step:report_snv]
dir=vcf
pbs_queue=$[global]pbs_queue
pbs_mem=16GB
pbs_ncpus=2
pbs_walltime=08:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python,python3/3.7.4,R/3.6.1
cmd_1=$[directories]pipeline/scripts/step_reportsnv.pl
bgzip_bin=$[tools]bgzip
tabix_bin=$[tools]tabix
picard_bin=$[tools]picard
gatk_bin=$[tools]gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xms8g -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"
peddy_bin=$[tools]peddy
pcaplot_bin=Rscript $[directories]pipeline/scripts/plot_PopulationPCA.R
peddy_dir=peddy
dbsnp=$[directories]genome/$[references]gatkbundle/Homo_sapiens_assembly38.dbsnp138.vcf
#this is the final coverage filter:
filter_rd_cvr = 5

[step:summary_report]
dir=report
pbs_queue=$[global]pbs_queue
pbs_mem=8GB
pbs_ncpus=1
pbs_walltime=01:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python,python3/3.7.4,R/3.6.1
cmd_1=$[directories]pipeline/scripts/step_summaryreport.pl

[step:gatk_cnv_intervals]
dir=gatk_cnv
pbs_queue=$[global]pbs_queue
pbs_mem=8GB
pbs_ncpus=1
pbs_walltime=01:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_gatkcnvintervals.pl
gatk_bin=$[tools]gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xms4000m  -XX:+UseParallelGC -XX:ParallelGCThreads=4 -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"

[step:gatk_cnv_read_counts]
dir=gatk_cnv
pbs_queue=$[global]pbs_queue
pbs_mem=8GB
pbs_ncpus=1
pbs_walltime=01:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_gatkcnvreadcounts.pl
gatk_bin=$[tools]gatk --java-options "-Djava.io.tmpdir=\$PBS_JOBFS -Xms4000m  -XX:+UseParallelGC -XX:ParallelGCThreads=4 -DGATK_STACKTRACE_ON_USER_EXCEPTION=true"

[step:gatk_cnv_ploidy]
dir=gatk_cnv
pbs_queue=$[global]pbs_queue
pbs_mem=8GB
pbs_ncpus=2
pbs_walltime=12:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_gatkcnvploidy.pl
#this step requires GATK python conda enviro. see below how it is switched on
gatk_bin=unset PYTHONPATH; source $[directories]tools/miniconda3/etc/profile.d/conda.sh; conda activate gatk; export MKL_DYNAMIC=false; export OMP_NESTED=true; export MKL_NUM_THREADS=2; export OMP_NUM_THREADS=2; $[tools]gatk 
contig_ploidy_model=$[directories]genome/GATK_cnv/ploidy_WES-model

[step:split:gatk_cnv_caller]
dir=gatk_cnv
pbs_queue=$[global]pbs_queue
pbs_mem=48GB
pbs_ncpus=8
pbs_walltime=24:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_gatkcnvcaller.pl
#this step requires GATK python conda enviro. see below how it is switched on
gatk_bin=unset PYTHONPATH; source $[directories]tools/miniconda3/etc/profile.d/conda.sh; conda activate gatk; export MKL_DYNAMIC=false; export OMP_NESTED=true; export MKL_NUM_THREADS=8; export OMP_NUM_THREADS=8; $[tools]gatk 
#do not put the '-model' suffix below, the expected actuall names include split, eg. caller_WES.01-model, caller_WES.02-model...
cnv_caller_model=$[directories]genome/GATK_cnv/caller_WES

[step:gatk_cnv_gather_calls]
dir=gatk_cnv
pbs_queue=$[global]pbs_queue
pbs_mem=32GB
pbs_ncpus=8
pbs_walltime=24:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_gatkcnvgather.pl
#this step requires GATK python conda enviro. see below how it is switched on
gatk_bin=unset PYTHONPATH; source $[directories]tools/miniconda3/etc/profile.d/conda.sh; conda activate gatk; export MKL_DYNAMIC=false; export OMP_NESTED=true; export MKL_NUM_THREADS=8; export OMP_NUM_THREADS=8; $[tools]gatk 
cnv_caller_model=$[directories]genome/GATK_cnv/caller_WES

[step:report_cnv]
dir=gatk_cnv
pbs_queue=$[global]pbs_queue
pbs_mem=8GB
pbs_ncpus=1
pbs_walltime=1:00:00
pbs_jobfs=100GB
modules=java/jdk-13.33,python3-as-python
cmd_1=$[directories]pipeline/scripts/step_reportcnv.pl
bgzip_bin=$[tools]bgzip
tabix_bin=$[tools]tabix
vep_bin=$[tools]vep
fasta=$[directories]vep_db/Homo_sapiens.GRCh38.dna.primary_assembly.fa.bgz
